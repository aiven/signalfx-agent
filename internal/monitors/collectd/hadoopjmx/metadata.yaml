monitors:
- dimensions:
  doc: |
    Collects metrics about a Hadoop cluster using using collectd's GenericJMX plugin.

    Also see https://github.com/signalfx/integrations/tree/master/collectd-hadoop.

    To enable JMX in Hadoop, add the following JVM options to hadoop-env.sh and yarn-env.sh respectively

    **hadoop-env.sh:**
    ```sh
    export HADOOP_NAMENODE_OPTS="-Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.port=5677 $HADOOP_NAMENODE_OPTS"
    export HADOOP_DATANODE_OPTS="-Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.port=5679 $HADOOP_DATANODE_OPTS"
    ```

    **yarn-env.sh:**
    ```sh
    export YARN_NODEMANAGER_OPTS="-Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.port=8002 $YARN_NODEMANAGER_OPTS"
    export YARN_RESOURCEMANAGER_OPTS="-Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.port=5680 $YARN_RESOURCEMANAGER_OPTS"
    ```

    This monitor has a set of built in MBeans configured for:
      - [Name Nodes](https://github.com/signalfx/signalfx-agent/tree/master/internal/monitors/collectd/hadoopjmx/nameNodeMBeans.go)
      - [Resource Manager](https://github.com/signalfx/signalfx-agent/tree/master/internal/monitors/collectd/hadoopjmx/resourceManagerMBeans.go)
      - [Node Manager](https://github.com/signalfx/signalfx-agent/tree/master/internal/monitors/collectd/hadoopjmx/nodeManagerMBeans.go)
      - [Data Nodes](https://github.com/signalfx/signalfx-agent/tree/master/internal/monitors/collectd/hadoopjmx/dataNodeMBeans.go)

    Sample YAML configuration:

    Name Node
    ```yaml
    monitors:
    - type: collectd/hadoopjmx
      host: 127.0.0.1
      port: 5677
      nodeType: nameNode
    ```

    Resource Manager
    ```yaml
    monitors:
    - type: collectd/hadoopjmx
      host: 127.0.0.1
      port: 5680
      nodeType: resourceManager
    ```

    Node Manager
    ```yaml
    monitors:
    - type: collectd/hadoopjmx
      host: 127.0.0.1
      port: 8002
      nodeType: nodeManager
    ```

    Data Node
    ```yaml
    monitors:
    - type: collectd/hadoopjmx
      host: 127.0.0.1
      port: 5679
      nodeType: dataNode
    ```

    You may also configure the [collectd/hadoop](https://github.com/signalfx/signalfx-agent/tree/master/docs/monitors/collectd/hadoop)
    monitor to collect additional metrics about the hadoop cluster from the REST API
  metrics:
    # Taken from genericjmx monitor. If you want to change them update genericjmx and update
    # all other monitors that use genericjmx with this same notice.
    gauge.jvm.threads.count:
      description: Number of JVM threads
      included: true
      type: gauge
    gauge.loaded_classes:
      description: Number of classes loaded in the JVM
      included: true
      type: gauge
    invocations:
      description: Total number of garbage collection events
      included: true
      type: cumulative
    jmx_memory.committed:
      description: Amount of memory guaranteed to be available in bytes
      included: true
      type: gauge
    jmx_memory.max:
      description: Maximum amount of memory that can be used in bytes
      included: true
      type: gauge
    jmx_memory.used:
      description: Current memory usage in bytes
      included: true
      type: gauge
    total_time_in_ms.collection_time:
      description: Amount of time spent garbage collecting in milliseconds
      included: true
      type: cumulative
    jmx_memory.init:
      description: Amount of initial memory at startup in bytes
      included: true
      type: gauge

    counter.hadoop-namenode-gc-count:
      description:
      included: true
      type: cumulative
    counter.hadoop-namenode-gc-time:
      description:
      included: true
      type: cumulative
    counter.hadoop-namenode-rpc-total-calls:
      description:
      included: true
      type: cumulative
    counter.hadoop-namenode-total-load:
      description:
      included: true
      type: cumulative
    counter.hadoop-namenode-volume-failures:
      description:
      included: true
      type: cumulative
    gauge.hadoop-datanode-fs-capacity:
      description:
      included: true
      type: gauge
    gauge.hadoop-datanode-fs-dfs-remaining:
      description:
      included: true
      type: gauge
    gauge.hadoop-datanode-fs-dfs-used:
      description:
      included: true
      type: gauge
    gauge.hadoop-datanode-jvm-heap-used:
      description:
      included: true
      type: gauge
    gauge.hadoop-datanode-rpc-call-queue-length:
      description:
      included: true
      type: gauge
    gauge.hadoop-datanode-rpc-open-connections:
      description:
      included: true
      type: gauge
    gauge.hadoop-datanode-rpc-processing-avg:
      description:
      included: true
      type: gauge
    gauge.hadoop-datanode-rpc-queue-time-avg:
      description:
      included: true
      type: gauge
    gauge.hadoop-namenode-capacity-total:
      description:
      included: true
      type: gauge
    gauge.hadoop-namenode-capacity-used:
      description:
      included: true
      type: gauge
    gauge.hadoop-namenode-current-heap-used:
      description:
      included: true
      type: gauge
    gauge.hadoop-namenode-dead-datanodes:
      description:
      included: true
      type: gauge
    gauge.hadoop-namenode-dfs-free:
      description:
      included: true
      type: gauge
    gauge.hadoop-namenode-live-datanodes:
      description:
      included: true
      type: gauge
    gauge.hadoop-namenode-max-heap:
      description:
      included: true
      type: gauge
    gauge.hadoop-namenode-percent-remaining:
      description:
      included: true
      type: gauge
    gauge.hadoop-namenode-rpc-avg-process-time:
      description:
      included: true
      type: gauge
    gauge.hadoop-namenode-rpc-avg-queue:
      description:
      included: true
      type: gauge
    gauge.hadoop-namenode-under-replicated-blocks:
      description:
      included: true
      type: gauge
    gauge.hadoop-resourceManager-allocated-vcores:
      description:
      included: true
      type: gauge
    gauge.hadoop-resourceManager-available-vcores:
      description:
      included: true
      type: gauge
  monitorType: collectd/hadoopjmx
  properties:
